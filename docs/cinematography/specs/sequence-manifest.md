# Sequence Manifest Spec

**Status:** Draft
**Issue:** ANI-13
**Version:** 1.0

## Overview

A sequence manifest is an ordered list of scenes with timing, transitions, and global settings. It is the edit decision list — the JSON equivalent of a video timeline. Manifests can be authored by hand or generated by the AI sequence planner (Phase 4).

## Schema

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "required": ["sequence_id", "scenes"],
  "properties": {
    "sequence_id": {
      "type": "string",
      "pattern": "^seq_[a-z0-9_]+$",
      "description": "Unique sequence identifier. Convention: seq_{descriptive_name}"
    },
    "resolution": {
      "type": "object",
      "properties": {
        "w": { "type": "integer", "default": 1920 },
        "h": { "type": "integer", "default": 1080 }
      },
      "description": "Output video dimensions."
    },
    "fps": {
      "type": "integer",
      "enum": [24, 30, 60],
      "default": 60,
      "description": "Output frame rate."
    },
    "scenes": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/scene_entry" },
      "description": "Ordered scene list. Playback order matches array order."
    },
    "style": {
      "type": "string",
      "enum": ["prestige", "energy", "dramatic"],
      "description": "Style pack reference. Informs AI planner decisions. Optional for hand-authored manifests."
    },
    "audio": {
      "$ref": "#/$defs/audio_track",
      "description": "Optional audio track. Future — not processed in v1."
    }
  }
}
```

### Scene Entry Definition

```json
{
  "$defs": {
    "scene_entry": {
      "type": "object",
      "required": ["scene"],
      "properties": {
        "scene": {
          "type": "string",
          "description": "Scene ID reference (matches a scene_id in the scenes directory) or path to scene JSON file."
        },
        "duration_s": {
          "type": "number",
          "minimum": 0.5,
          "maximum": 30,
          "description": "Hold duration. Overrides the scene's own duration_s if provided."
        },
        "transition_in": {
          "$ref": "#/$defs/transition",
          "description": "How this scene enters. Default: hard_cut."
        },
        "camera_override": {
          "type": "object",
          "properties": {
            "move": { "type": "string", "enum": ["static", "push_in", "pull_out", "pan_left", "pan_right", "drift"] },
            "intensity": { "type": "number", "minimum": 0, "maximum": 1 },
            "easing": { "type": "string", "enum": ["linear", "ease_out", "cinematic_scurve"] }
          },
          "description": "Override the scene's camera directive for this sequence context."
        },
        "shot_grammar": {
          "type": "object",
          "properties": {
            "shot_size": { "type": "string", "enum": ["wide", "medium", "close_up", "extreme_close_up"] },
            "angle": { "type": "string", "enum": ["eye_level", "high", "low", "dutch"] },
            "framing": { "type": "string", "enum": ["center", "rule_of_thirds_left", "rule_of_thirds_right", "dynamic_offset"] }
          },
          "description": "Shot grammar classification. Added by the AI planner (ANI-26). Validated against personality restrictions. Optional — not present in hand-authored manifests unless explicitly set."
        }
      }
    }
  }
}
```

### Transition Definition

```json
{
  "$defs": {
    "transition": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["hard_cut", "crossfade", "whip_left", "whip_right", "whip_up", "whip_down"],
          "default": "hard_cut",
          "description": "Transition type between previous scene and this scene."
        },
        "duration_ms": {
          "type": "integer",
          "minimum": 0,
          "maximum": 2000,
          "default": 0,
          "description": "Transition duration. hard_cut=0ms, crossfade=200-800ms, whip=250ms."
        }
      }
    }
  }
}
```

#### Transition Types

| Type | Implementation | Default Duration | Source |
|------|---------------|-----------------|--------|
| `hard_cut` | Instant scene swap | 0ms | Default |
| `crossfade` | Opacity interpolation, both scenes render during overlap | 400ms | Montage personality |
| `whip_left` | Clip-path `inset()` wipe from right to left | 250ms | Montage `mo-whip-wipe` |
| `whip_right` | Clip-path `inset()` wipe from left to right | 250ms | Montage `mo-whip-wipe` |
| `whip_up` | Clip-path `inset()` wipe from bottom to top | 250ms | Montage `mo-whip-wipe` |
| `whip_down` | Clip-path `inset()` wipe from top to bottom | 250ms | Montage `mo-whip-wipe` |

During crossfade and whip transitions, both the outgoing and incoming scenes render simultaneously for the transition duration. The total video duration includes transition overlap — a 3s scene with a 400ms crossfade in means the scene content starts 400ms before the previous scene fully exits.

### Audio Track Definition (Future)

```json
{
  "$defs": {
    "audio_track": {
      "type": "object",
      "properties": {
        "src": {
          "type": "string",
          "description": "Audio file path or URL."
        },
        "volume": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 1
        },
        "fade_in_ms": {
          "type": "integer",
          "default": 0
        },
        "fade_out_ms": {
          "type": "integer",
          "default": 0
        }
      }
    }
  }
}
```

## Duration Calculation

Total video duration is the sum of all scene durations minus transition overlaps:

```
total = sum(scene.duration_s) - sum(transition.duration_ms / 1000)
```

For hard cuts (0ms), there is no overlap. For a sequence of 4 scenes at 3s each with 400ms crossfades between:

```
total = (3 + 3 + 3 + 3) - (0 + 0.4 + 0.4 + 0.4) = 10.8s
```

The first scene has no transition_in (it starts immediately).

## Examples

### Minimal Manifest (3 scenes, hard cuts)

```json
{
  "sequence_id": "seq_test_basic",
  "scenes": [
    { "scene": "sc_brand_mark", "duration_s": 2.5 },
    { "scene": "sc_product_ui", "duration_s": 3.0 },
    { "scene": "sc_notification_card", "duration_s": 2.0 }
  ]
}
```

Total duration: 7.5s. Resolution: 1920x1080 (default). FPS: 60 (default). All hard cuts.

### Prestige Style Manifest (mixed transitions)

```json
{
  "sequence_id": "seq_brand_prestige",
  "resolution": { "w": 1920, "h": 1080 },
  "fps": 60,
  "style": "prestige",
  "scenes": [
    {
      "scene": "sc_portrait_closeup",
      "duration_s": 3.0,
      "camera_override": { "move": "push_in", "intensity": 0.3 }
    },
    {
      "scene": "sc_portrait_type",
      "duration_s": 3.0,
      "transition_in": { "type": "crossfade", "duration_ms": 600 }
    },
    {
      "scene": "sc_architecture_grid",
      "duration_s": 2.5,
      "transition_in": { "type": "hard_cut" }
    },
    {
      "scene": "sc_toc_scroll",
      "duration_s": 2.0,
      "transition_in": { "type": "hard_cut" }
    },
    {
      "scene": "sc_biodiversity_logo",
      "duration_s": 2.5,
      "transition_in": { "type": "crossfade", "duration_ms": 400 }
    }
  ]
}
```

Total duration: 13.0 - 1.0 = 12.0s.

### Reference Manifest: `high.mp4`

Hand-authored manifest describing the reference sizzle reel (31s, 12 shots):

```json
{
  "sequence_id": "seq_high_reference",
  "resolution": { "w": 1920, "h": 1080 },
  "fps": 60,
  "style": "prestige",
  "scenes": [
    {
      "scene": "sc_portrait_closeup",
      "duration_s": 2.0,
      "camera_override": { "move": "push_in", "intensity": 0.3, "easing": "cinematic_scurve" }
    },
    {
      "scene": "sc_portrait_type",
      "duration_s": 2.5,
      "transition_in": { "type": "crossfade", "duration_ms": 400 },
      "camera_override": { "move": "push_in", "intensity": 0.2 }
    },
    {
      "scene": "sc_architecture_grid",
      "duration_s": 2.5,
      "transition_in": { "type": "hard_cut" },
      "camera_override": { "move": "pan_left", "intensity": 0.3 }
    },
    {
      "scene": "sc_toc_scroll",
      "duration_s": 2.0,
      "transition_in": { "type": "hard_cut" },
      "camera_override": { "move": "static" }
    },
    {
      "scene": "sc_product_ui",
      "duration_s": 3.5,
      "transition_in": { "type": "hard_cut" },
      "camera_override": { "move": "drift", "intensity": 0.3 }
    },
    {
      "scene": "sc_biodiversity_logo",
      "duration_s": 2.0,
      "transition_in": { "type": "hard_cut" },
      "camera_override": { "move": "static" }
    },
    {
      "scene": "sc_notification_card",
      "duration_s": 2.0,
      "transition_in": { "type": "hard_cut" },
      "camera_override": { "move": "static" }
    },
    {
      "scene": "sc_virtual_tryon_front",
      "duration_s": 2.5,
      "transition_in": { "type": "hard_cut" },
      "camera_override": { "move": "push_in", "intensity": 0.2 }
    },
    {
      "scene": "sc_virtual_tryon_blink",
      "duration_s": 1.5,
      "transition_in": { "type": "crossfade", "duration_ms": 300 }
    },
    {
      "scene": "sc_virtual_tryon_profile",
      "duration_s": 2.0,
      "transition_in": { "type": "crossfade", "duration_ms": 300 }
    },
    {
      "scene": "sc_collab_doc",
      "duration_s": 3.0,
      "transition_in": { "type": "hard_cut" },
      "camera_override": { "move": "drift", "intensity": 0.2 }
    },
    {
      "scene": "sc_brand_collage",
      "duration_s": 2.5,
      "transition_in": { "type": "hard_cut" }
    },
    {
      "scene": "sc_brand_check_device",
      "duration_s": 4.0,
      "transition_in": { "type": "crossfade", "duration_ms": 500 },
      "camera_override": { "move": "push_in", "intensity": 0.2, "easing": "ease_out" }
    }
  ]
}
```

Total: 31.5s - 1.5s transitions = 30.0s (close to reference 31.4s — within tolerance).

## Design Decisions

1. **Scene references, not inline scenes.** The manifest references scenes by ID. Scene definitions live in separate files. This allows the same scene to appear in multiple sequences and keeps manifests lightweight.

2. **Transitions belong to the incoming scene.** Each scene entry declares how it enters (`transition_in`). The first scene has no transition (it starts immediately). This is simpler than declaring transitions between scene pairs.

3. **Camera overrides are optional.** A scene has its own camera directive. The manifest can override it for sequence context (e.g., the same UI scene might get a push-in in a dramatic sequence but stay static in a prestige sequence).

4. **Style is metadata, not behavior.** The `style` field is informational for hand-authored manifests. The AI planner uses it to drive decisions. The renderer doesn't read the style field — it only reads concrete scene entries, durations, transitions, and camera directives.

5. **No timeline, just order + duration.** Scenes play sequentially. There is no concept of overlapping scenes (except during transitions) or parallel tracks. This keeps the format simple. Complex compositions are handled within individual scenes, not at the sequence level.

6. **Audio is deferred.** The `audio` field exists in the schema for forward compatibility but is not processed in v1. Audio sync requires Remotion's `<Audio>` component and beat detection tooling.
